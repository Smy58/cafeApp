import{a as x}from"./CPTJwZNp.js";import{_ as y,c as $}from"./kmicvKTu.js";import{_ as l,t as a,v as d,x as s,y as p,P as v,z as _,Q as P,R as b,L as g,B as I,M as C,r as O,S}from"./CXJOgngG.js";import{_ as w,u as k}from"./CkyD4NVd.js";import{_ as A,a as E,b as B}from"./Cr6u6v4V.js";import{u as T}from"./46IeNikU.js";import"./BXREgLoY.js";const L={props:{info:Object}},M={class:"cafe-header"},q=s("div",{class:"cafe-header__img"},null,-1),F={class:"cafe-header__content"},N={class:"cafe-header__name"},j={class:"cafe-header__address"},Y={class:"cafe-header__info"},z={class:"cafe-header__text"},D={class:"cafe-header__info"},V={class:"cafe-header__text"};function H(t,o,e,r,c,n){const i=y;return a(),d("div",M,[q,s("div",F,[s("h2",N,p(e.info.name),1),s("p",j,p(e.info.address),1),s("div",Y,[s("div",{class:v(`cafe-header__status ${e.info.status?"cafe-header__status_open":""}`)},null,2),s("p",z,p(e.info.status?"Open":"Closed"),1)]),s("div",D,[_(i,{color:"#757575"}),s("p",V,"Waiting "+p(e.info.waitingTime)+" min",1)])])])}const R=l(L,[["render",H]]),J={props:{menu:Object,activeChapter:String},data(){return{}},methods:{scrollEvent(){var t=window.document.querySelector(".menu-nav");t.classList.toggle("menu-nav_sticky",window.scrollY>373)}},beforeMount(){window.addEventListener("scroll",this.scrollEvent,!1)},unmounted(){window.removeEventListener("scroll",this.scrollEvent,!1)}},Q={class:"menu-nav"},U={class:"menu-nav__content"},W=["href"];function G(t,o,e,r,c,n){return a(),d("div",Q,[s("div",U,[(a(!0),d(P,null,b(e.menu,i=>(a(),d("a",{href:`#${i.id}`,class:v(`menu-nav__link ${i.id==e.activeChapter?"menu-nav__link_active":""}`),key:i.id},p(i.name),11,W))),128))])])}const K=l(J,[["render",G]]),X={props:{position:Object,onOpenPos:Function},data(){var t,o;return{name:((t=this.position)==null?void 0:t.name)||"",cost:((o=this.position)==null?void 0:o.cost)||0}},computed:{costString(){return this.cost.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")}},methods:{openPosition(){this.onOpenPos(this.position)}}},Z={class:"position"},tt={class:"position__content"},et={class:"position__img"},ot={class:"position__name"};function nt(t,o,e,r,c,n){const i=w;return a(),d("div",Z,[s("div",tt,[s("div",et,[_(i,{color:"#f2f2f2"})]),s("h4",ot,p(c.name),1)]),s("button",{onClick:o[0]||(o[0]=(...u)=>n.openPosition&&n.openPosition(...u)),class:"position__btn"},p(n.costString)+" ₸",1)])}const st=l(X,[["render",nt]]),ct={props:{positions:Array,onOpenPos:Function}},it={class:"positions"};function at(t,o,e,r,c,n){const i=st;return a(),d("div",it,[(a(!0),d(P,null,b(e.positions,u=>(a(),g(i,{key:u.id,position:u,onOpenPos:e.onOpenPos},null,8,["position","onOpenPos"]))),128))])}const rt=l(ct,[["render",at]]),dt={props:{chapter:Object,setActive:Function,onOpenPos:Function},data(){var t,o,e;return{id:((t=this.chapter)==null?void 0:t.id)||"",name:((o=this.chapter)==null?void 0:o.name)||"",positions:((e=this.chapter)==null?void 0:e.positions)||[]}},methods:{handleScroll(){const t=window.document.getElementById(this.id);let o=window.scrollY,e=t.offsetTop,r=t.offsetHeight;o>=e&&o<e+r&&this.setActive(this.id)}},beforeMount(){window.addEventListener("scroll",this.handleScroll)},unmounted(){window.removeEventListener("scroll",this.handleScroll)}},ut=["id"],_t={class:"chapter__title"};function pt(t,o,e,r,c,n){const i=rt;return a(),d("div",{class:"chapter",id:c.id},[s("h3",_t,p(c.name),1),_(i,{positions:c.positions,onOpenPos:e.onOpenPos},null,8,["positions","onOpenPos"])],8,ut)}const lt=l(dt,[["render",pt]]),ht={props:{menu:Object,onOpenPos:Function},data(){return{activeChapter:"0"}},methods:{handleActive(t){this.activeChapter=t}}},mt={class:"menu"};function ft(t,o,e,r,c,n){const i=K,u=lt;return a(),d("div",mt,[_(i,{menu:e.menu,activeChapter:c.activeChapter},null,8,["menu","activeChapter"]),(a(!0),d(P,null,b(e.menu,h=>(a(),g(u,{key:h.id,chapter:h,setActive:n.handleActive,onOpenPos:e.onOpenPos},null,8,["chapter","setActive","onOpenPos"]))),128))])}const vt=l(ht,[["render",ft]]),gt={props:{totalCost:Number},computed:{costString(){return(this.totalCost?this.totalCost:0).toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")}},methods:{openBusket(){this.$router.push("/busket")}}},Ct={class:"cafe-busket"},Pt={class:"cafe-busket__content"},bt={class:"cafe-busket__cost"};function $t(t,o,e,r,c,n){return a(),d("div",Ct,[s("div",Pt,[s("p",bt,[I("К оплате: "),s("b",null,p(n.costString)+" ₸",1)]),s("div",{onClick:o[0]||(o[0]=(...i)=>n.openBusket&&n.openBusket(...i)),class:"btn cafe-busket__btn"},"Смотреть заказ")])])}const kt=l(gt,[["render",$t]]),xt={data(){return{touchStart:0,orderAddons:[],orderIngredients:[],count:1}},props:{position:Object,isOpen:Boolean,onClose:Function},methods:{addAddon(t){this.orderAddons.push(t)},delAddon(t){const o=this.orderAddons.findIndex(e=>e.id===t.id);this.orderAddons.splice(o,1)},addIngred(t){this.orderIngredients.push(t)},delIngred(t){const o=this.orderIngredients.findIndex(e=>e.id===t.id);this.orderIngredients.splice(o,1)},plusCount(){this.count+=1},minusCount(){this.count-=1},clearData(){this.orderAddons=[],this.orderIngredients=[],this.count=1},closePopup(t){this.onClose(),this.clearData(),setTimeout(()=>{t.style.top="auto",t.style.bottom=0},1e3)},addToBusket(){const{addItem:t}=k(),o=document.querySelector(".cafe-popup"),e={id:this.orderItem.id,name:this.orderItem.name,cost:this.orderItem.cost,count:this.count,totalCost:this.totalCost,addons:this.orderAddons,ingredients:this.orderIngredients};t(e),this.clearData(),this.closePopup(o)},onTouchStart(t){console.log(t),this.touchStart=t.changedTouches[0].clientY},onTouchMove(t,o){var e=o.targetTouches[0];e.clientY>=this.touchStart&&(t.style.bottom=0-(e.clientY-this.touchStart)+"px")},onTouchEnd(t,o){var e=o.changedTouches[0];e.clientY>150+this.touchStart?this.closePopup(t):(t.style.top="auto",t.style.bottom=0)}},computed:{totalCost(){let t=this.orderItem.cost;return this.orderAddons.forEach(o=>{t+=o.cost}),this.orderIngredients.forEach(o=>{t+=o.cost}),t},orderItem(){return{id:this.position.id,name:this.position.name,cost:this.position.cost}}},mounted(){const t=document.querySelector(".cafe-popup__drag-zone"),o=document.querySelector(".cafe-popup");o.style.bottom=0,t.addEventListener("touchstart",e=>{this.onTouchStart(e)}),t.addEventListener("touchmove",e=>{this.onTouchMove(o,e)}),t.addEventListener("touchend",e=>{this.onTouchEnd(o,e)})},beforeUnmount(){const t=document.querySelector(".cafe-popup__drag-zone"),o=document.querySelector(".cafe-popup");t.removeEventListener("touchstart",e=>{this.onTouchStart(e)}),t.removeEventListener("touchmove",e=>{this.onTouchMove(o,e)}),t.removeEventListener("touchend",e=>{this.onTouchEnd(o,e)})}},yt=s("div",{class:"cafe-popup__drag-zone"},[s("div",{class:"cafe-popup__drag-bar"})],-1),It={class:"cafe-popup__content"};function Ot(t,o,e,r,c,n){var m,f;const i=A,u=E,h=B;return a(),d("div",{class:v(`cafe-popup ${e.isOpen?"cafe-popup_show":""}`)},[yt,s("div",It,[_(i,{position:e.position},null,8,["position"]),(m=e.position)!=null&&m.addons||(f=e.position)!=null&&f.ingredients?(a(),g(u,{key:0,position:e.position,addAddon:n.addAddon,delAddon:n.delAddon,addIngred:n.addIngred,delIngred:n.delIngred},null,8,["position","addAddon","delAddon","addIngred","delIngred"])):C("",!0),_(h,{cost:n.totalCost,count:c.count,plusCount:n.plusCount,minusCount:n.minusCount,addToBusket:n.addToBusket},null,8,["cost","count","plusCount","minusCount","addToBusket"])])],2)}const St=l(xt,[["render",Ot]]),wt={data(){return{cafe:{},isPopup:!1,position:{}}},computed:{busket(){const{getBusket:t}=k();return t||[]},totalCost(){let t=0;return this.busket.forEach(o=>{t+=o.totalCost*o.count}),t}},methods:{tooglePopup(){this.isPopup=!this.isPopup,this.isPopup?document.body.style.overflow="hidden":document.body.style.overflow="auto"},openPosition(t){this.position=t,this.tooglePopup()}},async beforeMount(){const{setCurCafe:t}=T(),o=O({});let e=JSON.parse((this._.provides[S]||this.$route).query.cafeId);await $.getCafeId(e);const{data:r}=await $.getCafeId(e);o.value=await(r==null?void 0:r.value),t(o.value),this.cafe=o.value}},At={class:"cafe"};function Et(t,o,e,r,c,n){const i=x,u=R,h=vt,m=kt,f=St;return a(),d("div",At,[_(i),_(u,{info:c.cafe},null,8,["info"]),_(h,{menu:c.cafe.menu,onOpenPos:n.openPosition},null,8,["menu","onOpenPos"]),n.busket.length>0?(a(),g(m,{key:0,totalCost:n.totalCost},null,8,["totalCost"])):C("",!0),_(f,{onClose:n.tooglePopup,isOpen:c.isPopup,position:c.position},null,8,["onClose","isOpen","position"]),c.isPopup?(a(),d("div",{key:1,class:v(`cafe__bg ${c.isPopup?"cafe__bg_show":""}`)},null,2)):C("",!0)])}const jt=l(wt,[["render",Et]]);export{jt as default};
